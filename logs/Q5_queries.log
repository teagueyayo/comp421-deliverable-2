--relations used: customer, buys, house
--return the name of any customer has bought a house for > $1M
SELECT name
FROM customer
WHERE sin IN
	(SELECT B.csin
	 FROM buys B, house H
	 WHERE  (B.price >= 1000000) AND
	        (H.address = B.laddress))
--relations used: buys
--return total sales amount per agent sorted in descending order
SELECT aname, SUM(price)
FROM buys
GROUP BY aname ORDER BY SUM(price) DESC;
ERROR:  syntax error at or near "SELECT"
LINE 10: SELECT aname, SUM(price)
         ^
--relations used: real_estate_firm, buys, agent, company
--return total sales from every real estate in descending order
SELECT C.name, SUM(B.price)
FROM real_estate_firm F, buys B, agent A, company C
WHERE (A.company_id = F.id) AND (C.id = A.company_id)
GROUP BY C.id ORDER BY sum(B.price) DESC;
       name        |   sum   
-------------------+---------
 Boys Real Estate  | 4986000
 Best Real Estate  | 2493000
 Worst Real Estate | 2493000
 Girls Real Estate | 2493000
(4 rows)

--relations used: managed_by, apt_unit, listing
--return name of managet of the top 3 most expensive units
SELECT mname, baddress
FROM managed_by
WHERE baddress IN
	(SELECT A.building
	FROM apt_unit A, listing L
	WHERE (A.address = L.address)
	ORDER BY L.list_price DESC
	LIMIT 3);
         mname          |          baddress          
------------------------+----------------------------
 David The King Manager | 303 Apprtment Building St.
 Will Manager           | 404 Apprtment Building St.
 Aidon Manager          | 505 Apprtment Building St.
(3 rows)

--relations used: real_estate firm, buys, agent, company
--return all sales from every agent in every company, rolled up by company
SELECT C.name, B.aname, SUM(B.price)
FROM real_estate_firm F, buys B, agent A, company C
WHERE (A.company_id = F.id) AND (C.id = A.company_id)
GROUP BY ROLLUP(C.name, B.aname);
       name        |    aname    |   sum    
-------------------+-------------+----------
 Best Real Estate  | Agent Dave  |  1499000
 Best Real Estate  | Agent Josh  |   310000
 Best Real Estate  | Agent Katie |   295000
 Best Real Estate  | Agent Simon |   389000
 Best Real Estate  |             |  2493000
 Boys Real Estate  | Agent Dave  |  2998000
 Boys Real Estate  | Agent Josh  |   620000
 Boys Real Estate  | Agent Katie |   590000
 Boys Real Estate  | Agent Simon |   778000
 Boys Real Estate  |             |  4986000
 Girls Real Estate | Agent Dave  |  1499000
 Girls Real Estate | Agent Josh  |   310000
 Girls Real Estate | Agent Katie |   295000
 Girls Real Estate | Agent Simon |   389000
 Girls Real Estate |             |  2493000
 Worst Real Estate | Agent Dave  |  1499000
 Worst Real Estate | Agent Josh  |   310000
 Worst Real Estate | Agent Katie |   295000
 Worst Real Estate | Agent Simon |   389000
 Worst Real Estate |             |  2493000
                   |             | 12465000
(21 rows)

